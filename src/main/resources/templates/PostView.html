<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/PageLayout.html :: head(${post.title})}"></head>
<body>
<header th:replace="~{fragments/PageLayout.html :: header}"></header>

<div class="body-content">
    <h2 th:text="${post.title}">Post Title</h2>
    <div th:style="text-align">
        <p class="margin12" th:text="#{post.content} + ': ' +      ${post.content}">Content</p>
        <p class="margin12" th:text="#{post.created-by}  + ': ' + ${post.user.username}">Username</p>
        <p class="margin12" th:text="#{post.likes} + ': ' + ${post.likes}">Likes</p>
    </div>

    <!-- Like Post button - only visible to logged in users-->
    <div th:if="${currentUser != null}">
        <form th:action="@{/posts/{id}/like(id=${post.id})}" method="post" style="display: inline;">
            <button type="submit">Like Post</button>
        </form>
        <span th:if="${likeError != null}" style="color: red; margin-left: 10px;" th:text="${likeError}">Error message</span>
    </div>

    <!-- Edit Post button - only visible to post creator-->
    <div th:if="${currentUser != null and (currentUser.id == post.user.id)}">
        <a th:href="@{/posts/{id}/edit(id=${post.id})}">
            <button type="button">Edit Post</button>
        </a>
    </div>
    <!-- Delete Post button - only visible to post creator-->
    <div th:if="${currentUser != null and (currentUser.id == post.user.id)}">
        <form th:action="@{/posts/{id}/delete(id=${post.id})}" method="post" onsubmit="return confirm('Are you sure you want to delete this post? This action cannot be undone.');">
            <button type="submit">Delete Post</button>
        </form>
    </div>
    <div id="comment-advice" th:if="${session.currentUser == null}">
        <h4 th:text="#{comments.login-to-comment}">Please log in to add a comment.</h4>
    </div>

    <div id="comment-input" th:if="${session.currentUser != null}">
        <h3 th:text="#{comments.title}">Add a comment</h3>
        <form th:action="@{/posts/{id}/comment(id=${post.id})}" th:object="${comment}" method="post">
            <br>
                <textarea th:field="*{content}" placeholder="Enter your comment here" rows="3"></textarea>
            <br>
            <input type="submit" th:value="#{comments.submit}"/>
            <label class="label-error" th:if="${#fields.hasErrors('content')}" th:errors="*{content}">Error placeholder</label>
        </form>
    </div>

<!--    Below can be made to delete or update post to be used only by admins-->
<!--    which is not yet implemented-->
<!--    <h3>-->
<!--        &lt;!&ndash;    <a href="#" th:href="@{/beers/{id}/update(id=${beer.id})}">Update</a>&ndash;&gt;-->
<!--        &lt;!&ndash;    <a href="#" th:href="@{/beers/{id}/delete(id=${beer.id})}">Delete</a>&ndash;&gt;-->
<!--        <a href="#" th:href="@{__${requestURI}__/update}">Update</a>-->
<!--        <a href="#" th:href="@{__${requestURI}__/delete}">Delete</a>-->
<!--    </h3>-->

    <!-- Comments Section -->
    <hr>
    <div class="comments-section">
        <h3 th:text="#{comments.title}">Comments</h3>

        <!-- Show message if no comments -->
        <div th:if="${post.comments.isEmpty()}">
            <p th:text="#{comments.empty}">No comments yet</p>
        </div>

        <!-- Loop through all comments -->
        <div th:unless="${post.comments.isEmpty()}">
            <div class="comment" th:each="comment : ${post.comments}">
                <p class="comment-content" th:text="${comment.content}">Comment content here</p>
                <p class="comment-meta">
                    <span th:text="#{comment.user} + ' ' + ${comment.user.username}">By username</span>
                    <span> | </span>
                    <span th:text="#{comment.created-at} + ' ' + ${#temporals.format(comment.createdAt, 'yyyy-MM-dd HH:mm')}">Posted on date</span>
                </p>
                <hr>
            </div>
        </div>
    </div>
</div>

<footer th:replace="~{fragments/PageLayout.html :: footer}"></footer>
</body>
</html>