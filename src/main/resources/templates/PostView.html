<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/PageLayout.html :: head(${post.title})}"></head>
<body>
<header th:replace="~{fragments/PageLayout.html :: header}"></header>

<div class="body-content">
    <h1 th:text="${post.title}">Post Title</h1>
    
    <section class="post-content">
        <p class="margin12" th:text="${post.content}">Content</p>
        <p class="text-muted margin12">
            <strong>ğŸ‘¤ </strong><span th:text="#{post.created-by}">Created by</span>: <span th:text="${post.user.username}">Username</span>
        </p>
        <p class="margin12">
            <strong>â¤ï¸ </strong><span th:text="#{post.likes}">Likes</span>: <span th:text="${post.likes}">0</span>
        </p>
    </section>

    <!-- Action buttons - only visible to logged in users -->
    <div th:if="${currentUser != null}">
        <div class="action-buttons">
            <!-- Like Post button -->
            <form th:action="@{/posts/{id}/like(id=${post.id})}" method="post">
                <button type="submit">â¤ï¸ Like Post</button>
            </form>

            <!-- Edit Post button - only for post creator -->
            <a th:if="${currentUser.id == post.user.id}"
               th:href="@{/posts/{id}/edit(id=${post.id})}"
               class="btn-secondary">âœï¸ Edit Post</a>

            <!-- Delete Post button - only for post creator -->
            <form th:if="${currentUser.id == post.user.id}"
                  th:action="@{/posts/{id}/delete(id=${post.id})}"
                  method="post"
                  onsubmit="return confirm('Are you sure you want to delete this post? This action cannot be undone.');">
                <button type="submit" class="btn-danger">ğŸ—‘ï¸ Delete Post</button>
            </form>
        </div>

        <!-- Error message displayed below buttons -->
        <div th:if="${likeError != null}">
            <span class="error" th:text="${likeError}">Error message</span>
        </div>
    </div>
    
    <!-- Comment input section -->
    <div id="comment-advice" th:if="${session.currentUser == null}">
        <h4 th:text="#{comments.login-to-comment}">Please log in to add a comment.</h4>
    </div>

    <div id="comment-input" th:if="${session.currentUser != null}">
        <h3>ğŸ’¬ Add a Comment</h3>
        <form th:action="@{/posts/{id}/comment(id=${post.id})}" th:object="${comment}" method="post">
            <textarea th:field="*{content}" placeholder="Share your thoughts..." rows="3"></textarea>
            <br>
            <input type="submit" th:value="#{comments.submit}"/>
            <label class="label-error" th:if="${#fields.hasErrors('content')}" th:errors="*{content}">Error placeholder</label>
        </form>
    </div>


    <!-- Comments Section -->
    <div class="comments-section">
        <h3 th:text="#{comments.title}">Comments</h3>

        <!-- Show message if no comments -->
        <div th:if="${post.comments.isEmpty()}">
            <p class="text-muted" th:text="#{comments.empty}">No comments yet</p>
        </div>

        <!-- Loop through all comments -->
        <div th:unless="${post.comments.isEmpty()}">
            <div class="comment" th:each="comment : ${post.comments}">
                <p class="comment-content" th:text="${comment.content}">Comment content here</p>
                <p class="comment-meta">
                    <span>ğŸ‘¤ </span>
                    <span th:text="#{comment.user} + ' ' + ${comment.user.username}">By username</span>
                    <span> | </span>
                    <span>ğŸ• </span>
                    <span th:text="#{comment.created-at} + ' ' + ${#temporals.format(comment.createdAt, 'yyyy-MM-dd HH:mm')}">Posted on date</span>
                </p>
            </div>
        </div>
    </div>
</div>

<footer th:replace="~{fragments/PageLayout.html :: footer}"></footer>
</body>
</html>